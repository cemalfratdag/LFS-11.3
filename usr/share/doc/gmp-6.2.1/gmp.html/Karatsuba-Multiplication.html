<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.0.2, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- This manual describes how to install and use the GNU multiple precision
arithmetic library, version 6.2.1.

Copyright 1991, 1993-2016, 2018-2020 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with no Invariant Sections,
with the Front-Cover Texts being "A GNU Manual", and with the Back-Cover
Texts being "You have freedom to copy and modify this GNU Manual, like GNU
software".  A copy of the license is included in
GNU Free Documentation License. -->
<title>Karatsuba Multiplication (GNU MP 6.2.1)</title>

<meta name="description" content="How to install and use the GNU multiple precision arithmetic library, version 6.2.1.">
<meta name="keywords" content="Karatsuba Multiplication (GNU MP 6.2.1)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Concept-Index.html" rel="index" title="Concept Index">
<link href="Multiplication-Algorithms.html" rel="up" title="Multiplication Algorithms">
<link href="Toom-3_002dWay-Multiplication.html" rel="next" title="Toom 3-Way Multiplication">
<link href="Basecase-Multiplication.html" rel="prev" title="Basecase Multiplication">
<style type="text/css">
<!--
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
pre.display-preformatted {font-family: inherit}
-->
</style>


</head>

<body lang="en">
<div class="subsection-level-extent" id="Karatsuba-Multiplication">
<div class="nav-panel">
<p>
Next: <a href="Toom-3_002dWay-Multiplication.html" accesskey="n" rel="next">Toom 3-Way Multiplication</a>, Previous: <a href="Basecase-Multiplication.html" accesskey="p" rel="prev">Basecase Multiplication</a>, Up: <a href="Multiplication-Algorithms.html" accesskey="u" rel="up">Multiplication</a> &nbsp; [<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsection" id="Karatsuba-Multiplication-1">15.1.2 Karatsuba Multiplication</h4>
<a class="index-entry-id" id="index-Karatsuba-multiplication"></a>

<p>The Karatsuba multiplication algorithm is described in Knuth section 4.3.3
part A, and various other textbooks.  A brief description is given here.
</p>
<p>The inputs <em class="math">x</em> and <em class="math">y</em> are treated as each split into two parts of
equal length (or the most significant part one limb shorter if N is odd).
</p>
<div class="example">
<div class="group"><pre class="example-preformatted"> high              low
+----------+----------+
|    x1    |    x0    |
+----------+----------+

+----------+----------+
|    y1    |    y0    |
+----------+----------+
</pre></div></div>

<p>Let <em class="math">b</em> be the power of 2 where the split occurs, i.e. if x0 is
<em class="math">k</em> limbs (y0 the same) then
<em class="math">b=2^(k*mp_bits_per_limb)</em>.
With that <em class="math">x=x1*b+x0</em> and <em class="math">y=y1*b+y0</em>, and the
following holds,
</p>
<div class="display">
<pre class="display-preformatted"><em class="math">x*y = (b^2+b)*x1*y1 - b*(x1-x0)*(y1-y0) + (b+1)*x0*y0</em>
</pre></div>

<p>This formula means doing only three multiplies of (N/2)x(N/2) limbs,
whereas a basecase multiply of NxN limbs is equivalent to four
multiplies of (N/2)x(N/2).  The factors <em class="math">(b^2+b)</em> etc represent
the positions where the three products must be added.
</p>
<div class="example">
<div class="group"><pre class="example-preformatted"> high                              low
+--------+--------+ +--------+--------+
|      x1*y1      | |      x0*y0      |
+--------+--------+ +--------+--------+
          +--------+--------+
      add |      x1*y1      |
          +--------+--------+
          +--------+--------+
      add |      x0*y0      |
          +--------+--------+
          +--------+--------+
      sub | (x1-x0)*(y1-y0) |
          +--------+--------+
</pre></div></div>

<p>The term <em class="math">(x1-x0)*(y1-y0)</em> is best calculated as an
absolute value, and the sign used to choose to add or subtract.  Notice the
sum <em class="math">high(x0*y0)+low(x1*y1)</em> occurs twice, so it&rsquo;s possible to do <em class="math">5*k</em> limb
additions, rather than <em class="math">6*k</em>, but in GMP extra function call overheads
outweigh the saving.
</p>
<p>Squaring is similar to multiplying, but with <em class="math">x=y</em> the formula reduces to
an equivalent with three squares,
</p>
<div class="display">
<pre class="display-preformatted"><em class="math">x^2 = (b^2+b)*x1^2 - b*(x1-x0)^2 + (b+1)*x0^2</em>
</pre></div>

<p>The final result is accumulated from those three squares the same way as for
the three multiplies above.  The middle term <em class="math">(x1-x0)^2</em> is now
always positive.
</p>
<p>A similar formula for both multiplying and squaring can be constructed with a
middle term <em class="math">(x1+x0)*(y1+y0)</em>.  But those sums can exceed
<em class="math">k</em> limbs, leading to more carry handling and additions than the form
above.
</p>
<p>Karatsuba multiplication is asymptotically an <em class="math">O(N^1.585<!-- /@w -->)</em> algorithm,
the exponent being <em class="math">log(3)/log(2)</em>, representing 3 multiplies
each <em class="math">1/2</em> the size of the inputs.  This is a big improvement over the
basecase multiply at <em class="math">O(N^2)</em> and the advantage soon overcomes the extra
additions Karatsuba performs.  <code class="code">MUL_TOOM22_THRESHOLD</code> can be as little
as 10 limbs.  The <code class="code">SQR</code> threshold is usually about twice the <code class="code">MUL</code>.
</p>
<p>The basecase algorithm will take a time of the form <em class="math">M(N) = a*N^2 + b*N + c</em> and the Karatsuba algorithm <em class="math">K(N) = 3*M(N/2) + d*N + e</em>, which expands to <em class="math">K(N) = 3/4*a*N^2 + 3/2*b*N + 3*c + d*N + e</em>.  The
factor <em class="math">3/4</em> for <em class="math">a</em> means per-crossproduct speedups in the
basecase code will increase the threshold since they benefit <em class="math">M(N)</em> more
than <em class="math">K(N)</em>.  And conversely the <em class="math">3/2</em> for <em class="math">b</em> means
linear style speedups of <em class="math">b</em> will increase the threshold since they
benefit <em class="math">K(N)</em> more than <em class="math">M(N)</em>.  The latter can be seen for
instance when adding an optimized <code class="code">mpn_sqr_diagonal</code> to
<code class="code">mpn_sqr_basecase</code>.  Of course all speedups reduce total time, and in
that sense the algorithm thresholds are merely of academic interest.
</p>

</div>
<hr>
<div class="nav-panel">
<p>
Next: <a href="Toom-3_002dWay-Multiplication.html">Toom 3-Way Multiplication</a>, Previous: <a href="Basecase-Multiplication.html">Basecase Multiplication</a>, Up: <a href="Multiplication-Algorithms.html">Multiplication</a> &nbsp; [<a href="Concept-Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
