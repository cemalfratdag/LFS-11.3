<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.0.2, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 
This manual is for GNU tar (version
1.34, 4 February 2021), which creates and extracts files
from archives.

Copyright Â© 1992, 1994-1997, 1999-2001, 2003-2017, 2021
Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being "GNU General Public License", with the
Front-Cover Texts being "A GNU Manual", and with the Back-Cover Texts
as in (a) below.  A copy of the license is included in the section
entitled "GNU Free Documentation License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual." -->
<title>Sparse Recovery (GNU tar 1.34)</title>

<meta name="description" content="Sparse Recovery (GNU tar 1.34)">
<meta name="keywords" content="Sparse Recovery (GNU tar 1.34)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index-of-Command-Line-Options.html" rel="index" title="Index of Command Line Options">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Other-Tars.html" rel="up" title="Other Tars">
<link href="Split-Recovery.html" rel="prev" title="Split Recovery">
<style type="text/css">
<!--
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
-->
</style>


</head>

<body lang="en">
<div class="subsubsection-level-extent" id="Sparse-Recovery">
<div class="nav-panel">
<p>
Previous: <a href="Split-Recovery.html" accesskey="p" rel="prev">Extracting Members Split Between Volumes</a>, Up: <a href="Other-Tars.html" accesskey="u" rel="up">How to Extract GNU-Specific Data Using Other <code class="command">tar</code> Implementations</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index-of-Command-Line-Options.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h4 class="subsubsection" id="Extracting-Sparse-Members">8.3.10.2 Extracting Sparse Members</h4>

<a class="index-entry-id" id="index-sparse-files_002c-extracting-with-non_002dGNU-tars"></a>
<p>Any <code class="command">tar</code> implementation will be able to extract sparse members from a
PAX archive.  However, the extracted files will be <em class="dfn">condensed</em>,
i.e., any zero blocks will be removed from them.  When we restore such
a condensed file to its original form, by adding zero blocks (or
<em class="dfn">holes</em>) back to their original locations, we call this process
<em class="dfn">expanding</em> a compressed sparse file.
</p>
<a class="index-entry-id" id="index-xsparse"></a>
<p>To expand a file, you will need a simple auxiliary program called
<code class="command">xsparse</code>.  It is available in source form from
<a class="uref" href="http://www.gnu.org/software/tar/utils/xsparse.html"><abbr class="acronym">GNU</abbr> <code class="command">tar</code>
home page</a>.
</p>
<a class="index-entry-id" id="index-sparse-files-v_002e1_002e0_002c-extracting-with-non_002dGNU-tars"></a>
<p>Let&rsquo;s begin with archive members in <em class="dfn">sparse format
version 1.0</em><a class="footnote" id="DOCF23" href="#FOOT23"><sup>23</sup></a>, which are the easiest to expand.
The condensed file will contain both file map and file data, so no
additional data will be needed to restore it.  If the original file
name was <samp class="file"><var class="var">dir</var>/<var class="var">name</var></samp>, then the condensed file will be
named <samp class="file"><var class="var">dir</var>/GNUSparseFile.<var class="var">n</var>/<var class="var">name</var></samp>, where
<var class="var">n</var> is a decimal number<a class="footnote" id="DOCF24" href="#FOOT24"><sup>24</sup></a>.
</p>
<p>To expand a version 1.0 file, run <code class="command">xsparse</code> as follows:
</p>
<div class="example smallexample">
<pre class="example-preformatted">$ <kbd class="kbd">xsparse <samp class="file">cond-file</samp></kbd>
</pre></div>

<p>where <samp class="file">cond-file</samp> is the name of the condensed file.  The utility
will deduce the name for the resulting expanded file using the
following algorithm:
</p>
<ol class="enumerate">
<li> If <samp class="file">cond-file</samp> does not contain any directories,
<samp class="file">../cond-file</samp> will be used;

</li><li> If <samp class="file">cond-file</samp> has the form
<samp class="file"><var class="var">dir</var>/<var class="var">t</var>/<var class="var">name</var></samp>, where both <var class="var">t</var> and <var class="var">name</var>
are simple names, with no &lsquo;<samp class="samp">/</samp>&rsquo; characters in them, the output file
name will be <samp class="file"><var class="var">dir</var>/<var class="var">name</var></samp>.

</li><li> Otherwise, if <samp class="file">cond-file</samp> has the form
<samp class="file"><var class="var">dir</var>/<var class="var">name</var></samp>, the output file name will be
<samp class="file"><var class="var">name</var></samp>.
</li></ol>

<p>In the unlikely case when this algorithm does not suit your needs,
you can explicitly specify output file name as a second argument to
the command:
</p>
<div class="example smallexample">
<pre class="example-preformatted">$ <kbd class="kbd">xsparse <samp class="file">cond-file</samp> <samp class="file">out-file</samp></kbd>
</pre></div>

<p>It is often a good idea to run <code class="command">xsparse</code> in <em class="dfn">dry run</em> mode
first.  In this mode, the command does not actually expand the file,
but verbosely lists all actions it would be taking to do so.  The dry
run mode is enabled by <samp class="option">-n</samp> command line argument:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">$ <kbd class="kbd">xsparse -n /home/gray/GNUSparseFile.6058/sparsefile</kbd>
Reading v.1.0 sparse map
Expanding file '/home/gray/GNUSparseFile.6058/sparsefile' to
'/home/gray/sparsefile'
Finished dry run
</pre></div></div>

<p>To actually expand the file, you would run:
</p>
<div class="example smallexample">
<pre class="example-preformatted">$ <kbd class="kbd">xsparse /home/gray/GNUSparseFile.6058/sparsefile</kbd>
</pre></div>

<p>The program behaves the same way all UNIX utilities do: it will keep
quiet unless it has something important to tell you (e.g. an error
condition or something).  If you wish it to produce verbose output,
similar to that from the dry run mode, use <samp class="option">-v</samp> option:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">$ <kbd class="kbd">xsparse -v /home/gray/GNUSparseFile.6058/sparsefile</kbd>
Reading v.1.0 sparse map
Expanding file '/home/gray/GNUSparseFile.6058/sparsefile' to
'/home/gray/sparsefile'
Done
</pre></div></div>

<p>Additionally, if your <code class="command">tar</code> implementation has extracted the
<em class="dfn">extended headers</em> for this file, you can instruct <code class="command">xstar</code>
to use them in order to verify the integrity of the expanded file.
The option <samp class="option">-x</samp> sets the name of the extended header file to
use.  Continuing our example:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">$ <kbd class="kbd">xsparse -v -x /home/gray/PaxHeaders/sparsefile \
  /home/gray/GNUSparseFile/sparsefile</kbd>
Reading extended header file
Found variable GNU.sparse.major = 1
Found variable GNU.sparse.minor = 0
Found variable GNU.sparse.name = sparsefile
Found variable GNU.sparse.realsize = 217481216
Reading v.1.0 sparse map
Expanding file '/home/gray/GNUSparseFile.6058/sparsefile' to
'/home/gray/sparsefile'
Done
</pre></div></div>

<a class="anchor" id="extracting-sparse-v0x"></a><a class="index-entry-id" id="index-sparse-files-v_002e0_002e1_002c-extracting-with-non_002dGNU-tars"></a>
<a class="index-entry-id" id="index-sparse-files-v_002e0_002e0_002c-extracting-with-non_002dGNU-tars"></a>
<p>An <em class="dfn">extended header</em> is a special <code class="command">tar</code> archive header
that precedes an archive member and contains a set of
<em class="dfn">variables</em>, describing the member properties that cannot be
stored in the standard <code class="code">ustar</code> header.  While optional for
expanding sparse version 1.0 members, the use of extended headers is
mandatory when expanding sparse members in older sparse formats: v.0.0
and v.0.1 (The sparse formats are described in detail in <a class="ref" href="Sparse-Formats.html">Storing Sparse Files</a>.)  So, for these formats, the question is: how to obtain
extended headers from the archive?
</p>
<p>If you use a <code class="command">tar</code> implementation that does not support PAX
format, extended headers for each member will be extracted as a
separate file.  If we represent the member name as
<samp class="file"><var class="var">dir</var>/<var class="var">name</var></samp>, then the extended header file will be
named <samp class="file"><var class="var">dir</var>/PaxHeaders/<var class="var">name</var></samp>.
</p>
<p>Things become more difficult if your <code class="command">tar</code> implementation
does support PAX headers, because in this case you will have to
manually extract the headers.  We recommend the following algorithm:
</p>
<ol class="enumerate">
<li> Consult the documentation of your <code class="command">tar</code> implementation for an
option that prints <em class="dfn">block numbers</em> along with the archive
listing (analogous to <abbr class="acronym">GNU</abbr> <code class="command">tar</code>&rsquo;s <samp class="option">-R</samp> option).  For example,
<code class="command">star</code> has <samp class="option">-block-number</samp>.

</li><li> Obtain verbose listing using the &lsquo;<samp class="samp">block number</samp>&rsquo; option, and
find block numbers of the sparse member in question and the member
immediately following it.  For example, running <code class="command">star</code> on our
archive we obtain:

<div class="example smallexample">
<div class="group"><pre class="example-preformatted">$ <kbd class="kbd">star -t -v -block-number -f arc.tar</kbd>
&hellip;
star: Unknown extended header keyword 'GNU.sparse.size' ignored.
star: Unknown extended header keyword 'GNU.sparse.numblocks' ignored.
star: Unknown extended header keyword 'GNU.sparse.name' ignored.
star: Unknown extended header keyword 'GNU.sparse.map' ignored.
block        56:  425984 -rw-r--r--  gray/users Jun 25 14:46 2006 GNUSparseFile.28124/sparsefile
block       897:   65391 -rw-r--r--  gray/users Jun 24 20:06 2006 README
&hellip;
</pre></div></div>

<p>(as usual, ignore the warnings about unknown keywords.)
</p>
</li><li> Let <var class="var">size</var> be the size of the sparse member, <var class="var">Bs</var> be its block number
and <var class="var">Bn</var> be the block number of the next member.
Compute:

<div class="example smallexample">
<pre class="example-preformatted"><var class="var">N</var> = <var class="var">Bs</var> - <var class="var">Bn</var> - <var class="var">size</var>/512 - 2
</pre></div>

<p>This number gives the size of the extended header part in tar <em class="dfn">blocks</em>.
In our example, this formula gives: <code class="code">897 - 56 - 425984 / 512 - 2
= 7</code>.
</p>
</li><li> Use <code class="command">dd</code> to extract the headers:

<div class="example smallexample">
<pre class="example-preformatted"><kbd class="kbd">dd if=<var class="var">archive</var> of=<var class="var">hname</var> bs=512 skip=<var class="var">Bs</var> count=<var class="var">N</var></kbd>
</pre></div>

<p>where <var class="var">archive</var> is the archive name, <var class="var">hname</var> is a name of the
file to store the extended header in, <var class="var">Bs</var> and <var class="var">N</var> are
computed in previous steps.
</p>
<p>In our example, this command will be
</p>
<div class="example smallexample">
<pre class="example-preformatted">$ <kbd class="kbd">dd if=arc.tar of=xhdr bs=512 skip=56 count=7</kbd>
</pre></div>
</li></ol>

<p>Finally, you can expand the condensed file, using the obtained header:
</p>
<div class="example smallexample">
<div class="group"><pre class="example-preformatted">$ <kbd class="kbd">xsparse -v -x xhdr GNUSparseFile.6058/sparsefile</kbd>
Reading extended header file
Found variable GNU.sparse.size = 217481216
Found variable GNU.sparse.numblocks = 208
Found variable GNU.sparse.name = sparsefile
Found variable GNU.sparse.map = 0,2048,1050624,2048,&hellip;
Expanding file 'GNUSparseFile.28124/sparsefile' to 'sparsefile'
Done
</pre></div></div>

</div>
<div class="footnotes-segment">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5 class="footnote-body-heading"><a id="FOOT23" href="#DOCF23">(23)</a></h5>
<p>See <a class="xref" href="PAX-1.html">PAX Format, Version 1.0</a>.</p>
<h5 class="footnote-body-heading"><a id="FOOT24" href="#DOCF24">(24)</a></h5>
<p>Technically speaking, <var class="var">n</var> is a
<em class="dfn">process <abbr class="acronym">ID</abbr></em> of the <code class="command">tar</code> process which created the
archive (see <a class="pxref" href="PAX-keywords.html">Controlling Extended Header Keywords</a>).</p>
</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Split-Recovery.html">Extracting Members Split Between Volumes</a>, Up: <a href="Other-Tars.html">How to Extract GNU-Specific Data Using Other <code class="command">tar</code> Implementations</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index-of-Command-Line-Options.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
